# Test Cases — ระบบอนุมัติสินเชื่อ (Loan Web)

เอกสารรวบรวม test case สำหรับทดสอบ Web Application และ Login

---

## 1. การล็อกอิน (Login)

| เลขที่ | Test Case | ขั้นตอน | ผลที่คาดหวัง | สถานะ |
|-------|-----------|---------|---------------|--------|
| L01 | แสดงหน้า Login | เปิดหน้าแรก (/) โดยยังไม่ล็อกอิน | แสดงหัวข้อ "กรอก PIN 6 หลัก" ช่องกรอก PIN และปุ่ม "เข้าสู่ระบบ" | ✅ E2E |
| L02 | Login ด้วย PIN ไม่ถูกต้อง | กรอก PIN 6 หลักที่ไม่มีในระบบ (เช่น 000000) แล้วกด "เข้าสู่ระบบ" | แสดงข้อความ "PIN ไม่ถูกต้อง" ยังอยู่ที่หน้า Login | ✅ E2E |
| L03 | Login ด้วย PIN ถูกต้อง | กรอก PIN 6 หลักที่ตรงกับ staff ในตาราง `staff` แล้วกด "เข้าสู่ระบบ" | เข้าสู่ระบบได้ แสดงหน้ารายการสินเชื่อ (หัวข้อ "รายการสินเชื่อทั้งหมด") และไม่เห็นฟอร์ม PIN | ✅ E2E |
| L04 | ออกจากระบบ (Logout) | หลังล็อกอินแล้ว กด "ออกจากระบบ" ใน Header แล้วกด "ออกจากระบบ" ในกล่องยืนยัน | แสดงกล่องยืนยัน "ต้องการออกจากระบบจริงหรือไม่?" หลังกดยืนยัน กลับมาเห็นหน้า "กรอก PIN 6 หลัก" | ✅ E2E |
| L05 | ยกเลิกการออกจากระบบ | หลังกด "ออกจากระบบ" ใน Header แล้วกด "ยกเลิก" ในกล่องยืนยัน | กล่องปิด ยังอยู่หน้ารายการสินเชื่อ ไม่ได้ logout | ✅ E2E |
| L06 | ช่อง PIN จำกัด 6 หลัก | กรอกตัวเลขเกิน 6 หลัก | ช่องรับได้ไม่เกิน 6 ตัว (maxLength=6) | Manual |
| L07 | สถานะล็อกอินคงอยู่หลังรีเฟรช | ล็อกอินแล้ว กด F5 หรือรีเฟรชหน้า | ยังคงล็อกอินอยู่ (อ่านจาก localStorage) | Manual |

---

## 2. หน้าหลักหลังล็อกอิน (List Page)

| เลขที่ | Test Case | ขั้นตอน | ผลที่คาดหวัง | สถานะ |
|-------|-----------|---------|---------------|--------|
| P01 | แสดงหัวข้อและปุ่มตาม Role | ล็อกอินด้วย staff แต่ละ role (sale / manager / approver) | แสดง "ระบบอนุมัติสินเชื่อ (พนักงานขาย/ผู้จัดการ/ผู้อนุมัติ)" role sale เห็นปุ่ม "สร้างแบบฟอร์มใหม่" | ✅ E2E (ส่วน sale) |
| P02 | แสดงตัวกรองรายการ | เปิดหน้ารายการหลังล็อกอิน | มีช่องค้นหา, dropdown สถานะ, ช่วงวันที่เสนอสินเชื่อ, ปุ่ม "ล้างตัวกรอง" | ✅ E2E |
| P03 | Header แสดงชื่อและปุ่มออกจากระบบ | ดูที่ Header หลังล็อกอิน | แสดงชื่อผู้ใช้และปุ่ม "ออกจากระบบ" | ✅ E2E |
| P04 | ค้นหารายการ | กรอกคำค้น (ชื่อ, ทะเบียน, ยี่ห้อ ฯลฯ) ในช่องค้นหา | รายการที่แสดงกรองตามคำค้น | Manual |
| P05 | กรองตามสถานะ | เลือกสถานะ (รอตรวจสอบ, ส่งกลับไปแก้ไข, อนุมัติ, ปฏิเสธ) | แสดงเฉพาะรายการที่ตรงกับสถานะที่เลือก | Manual |
| P06 | กรองตามวันที่เสนอสินเชื่อ | เลือกช่วงวันที่ใน Range Picker | แสดงเฉพาะรายการที่ submission_date อยู่ในช่วง | Manual |
| P07 | ล้างตัวกรอง | ตั้งค่าตัวกรองแล้วกด "ล้างตัวกรอง" | คำค้น สถานะ และช่วงวันที่ถูกล้าง รายการแสดงทั้งหมดตามสิทธิ์ | Manual |
| P08 | Pagination | เมื่อมีรายการมากกว่า 10 รายการ | แสดงเลขหน้า และ "ทั้งหมด N รายการ" เปลี่ยนหน้าได้ | Manual |
| P09 | ลิงก์ดูรายละเอียด | กด "ดูรายละเอียด" ของรายการใดๆ | ไปที่ `/loan/[id]` แสดงหน้ารายละเอียดสินเชื่อ | Manual |

---

## 3. การนำทาง (Navigation) และสิทธิ์

| เลขที่ | Test Case | ขั้นตอน | ผลที่คาดหวัง | สถานะ |
|-------|-----------|---------|---------------|--------|
| N01 | ปุ่มสร้างแบบฟอร์มใหม่ (Sale) | ล็อกอินด้วย role sale | เห็นปุ่ม "สร้างแบบฟอร์มใหม่" คลิกแล้วไป `/loan/new` | ✅ E2E |
| N02 | ไม่มีปุ่มสร้างแบบฟอร์ม (Manager/Approver) | ล็อกอินด้วย role manager หรือ approver | ไม่แสดงปุ่ม "สร้างแบบฟอร์มใหม่" | Manual |
| N03 | คลิกโลโก้/ชื่อระบบ | คลิกลิงก์ "ระบบอนุมัติสินเชื่อ" ใน Header | อยู่ที่ `/` (หน้ารายการ) | ✅ E2E |
| N04 | เข้า /loan/new โดยไม่ล็อกอิน | ลบ localStorage หรือใช้ incognito ไปที่ `/loan/new` | ควรเห็นหน้า Login หรือถูกนำกลับไปหน้าแรก (ขึ้นกับ implementation) | ✅ E2E (ตรวจว่าไม่ crash) |
| N05 | เข้า /loan/[id] โดยไม่ล็อกอิน | ไปที่ URL รายการสินเชื่อโดยไม่ล็อกอิน | ควรเห็นหน้า Login หรือ redirect ไปหน้าแรก | ✅ E2E |

---

## 4. หน้ารายละเอียดสินเชื่อ (/loan/[id])

| เลขที่ | Test Case | ขั้นตอน | ผลที่คาดหวัง | สถานะ |
|-------|-----------|---------|---------------|--------|
| D01 | แสดงข้อมูลรายการ | ล็อกอินแล้วคลิก "ดูรายละเอียด" | แสดงหัวข้อ "รายละเอียดสินเชื่อ" ส่วนเลขที่อ้างอิง ข้อมูลผู้กู้ ข้อมูลสินเชื่อ ปุ่ม "กลับ" | ✅ E2E |
| D02 | ปุ่มแก้ไข (Sale เฉพาะของตัวเอง) | ล็อกอินเป็น sale ที่เป็นเจ้าของรายการ (สถานะรอตรวจสอบ/ส่งกลับ) | เห็นปุ่ม "แก้ไข" และเข้า /loan/[id]/edit ได้ | ✅ E2E |
| D03 | รายการไม่มีอยู่ | เข้า /loan/[uuid ที่ไม่มี] หลัง login | แสดง "ไม่พบรายการนี้" และปุ่ม "กลับ" | ✅ E2E |
| D04 | คลิก "กลับ" จากหน้ารายละเอียด | อยู่หน้ารายละเอียด แล้วกด "กลับ" | กลับไปหน้ารายการ (/) | ✅ E2E |
| D05 | ปุ่มอนุมัติ/ส่งกลับ/ปฏิเสธ (Approver) | ล็อกอินเป็น approver | เห็นปุ่มดำเนินการและสามารถเปลี่ยนสถานะได้ | Manual |
| D06 | Manager ไม่มีปุ่มอนุมัติ | ล็อกอินเป็น manager | ดูรายละเอียดได้ แต่ไม่มีปุ่มอนุมัติ/ปฏิเสธ | Manual |

---

## 5. หน้าสร้าง/แก้ไขแบบฟอร์ม (/loan/new, /loan/[id]/edit)

| เลขที่ | Test Case | ขั้นตอน | ผลที่คาดหวัง | สถานะ |
|-------|-----------|---------|---------------|--------|
| F01 | หน้า new: แสดงแบบฟอร์ม | ล็อกอินเป็น sale เข้า /loan/new | แสดง "แบบฟอร์มเสนอสินเชื่อใหม่" "กลับหน้ารายการ" "ประเภทสินเชื่อ" ปุ่ม "ส่งข้อมูลให้ผู้อนุมัติ" | ✅ E2E |
| F02 | หน้า new: คลิกกลับหน้ารายการ | อยู่หน้า /loan/new กด "กลับหน้ารายการ" | กลับไป / | ✅ E2E |
| F03 | หน้า edit: ไม่พบรายการ | เข้า /loan/[uuid ที่ไม่มี]/edit หลัง login | แสดง "ไม่พบรายการนี้หรือไม่มีสิทธิ์แก้ไข" และ "กลับหน้ารายการ" | ✅ E2E |
| F04 | หน้า edit: จากรายละเอียดเข้าแก้ไข | ล็อกอินเป็น sale เจ้าของรายการ กด "แก้ไข" | เข้าหน้า "แก้ไขข้อมูลสินเชื่อ" มี "กลับรายละเอียด" "หน้ารายการ" "บันทึกการแก้ไข" | ✅ E2E |
| F05 | หน้า edit: คลิกกลับรายละเอียด | อยู่หน้าแก้ไข กด "กลับรายละเอียด" | กลับไปหน้ารายละเอียด /loan/[id] | ✅ E2E |
| F06 | เลือกประเภทสินเชื่อ | เลือก รถส่วนบุคคล / รถเชิงพาณิชย์ / โฉนดที่ดิน | ฟิลด์ที่แสดงเปลี่ยนตามประเภท (เช่น โฉนดแสดงที่อยู่ ที่ดิน) | Manual |
| F07 | บันทึกแบบฟอร์มใหม่ | กรอกข้อมูลครบ (ตามประเภท) แล้วกดบันทึก | สร้างรายการใหม่ในระบบ แสดงหน้ารายละเอียดหรือกลับหน้ารายการ | Manual |
| F08 | อัปโหลดเอกสารแนบ | เลือกไฟล์ตามเช็คลิสต์เอกสาร | ไฟล์อัปโหลดไป Storage และแสดงในรายการเอกสารแนบ | Manual |
| F09 | Validation ฟิลด์บังคับ | ไม่กรอกฟิลด์บังคับแล้วกดบันทึก | แสดงข้อความแจ้งหรือป้องกันการส่ง | Manual |

---

## 6. สรุปการรัน E2E (Playwright)

- **รันเทสทั้งหมด**
  ```bash
  npm run test:e2e
  ```
- **รันแบบมี UI**
  ```bash
  npm run test:e2e:ui
  ```
- **เทสที่ต้องใช้ PIN จริง**  
  ตั้งค่า environment variable ก่อนรัน:
  ```bash
  PLAYWRIGHT_TEST_PIN=123456 npm run test:e2e
  ```
  (แทน `123456` ด้วย PIN 6 หลักของ staff ทดสอบใน Supabase)

เทสที่เกี่ยวกับ "ล็อกอินด้วย PIN ถูกต้อง" หรือ "หน้าหลักหลังล็อกอิน" หรือ "หน้ารายละเอียด/สร้าง/แก้ไข" จะถูก skip ถ้าไม่ได้ set `PLAYWRIGHT_TEST_PIN`

**ไฟล์เทส**
- `e2e/login.spec.ts` — Login / Logout
- `e2e/app.spec.ts` — หน้าหลัก, ตัวกรอง, navigation, การป้องกันโดยไม่ login
- `e2e/loan-detail.spec.ts` — หน้ารายละเอียด /loan/[id] (แสดงข้อมูล, ไม่พบรายการ, ปุ่มกลับ)
- `e2e/loan-new.spec.ts` — หน้าสร้างแบบฟอร์ม /loan/new (เฉพาะ role sale)
- `e2e/loan-edit.spec.ts` — หน้าแก้ไข /loan/[id]/edit (ไม่พบรายการ, จากรายละเอียดเข้าแก้ไข, ปุ่มกลับ)

---

*อัปเดตล่าสุด: เพิ่ม E2E หน้ารายละเอียด สร้าง และแก้ไข*
